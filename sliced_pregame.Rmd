---
title: "Some Pregame Plots"
author: "Michael Mullarkey"
date: "7/20/2021"
output: html_document
---

```{r setup, include=FALSE, cache = FALSE}
require("knitr")
## setting working directory
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE, warning = FALSE, message = FALSE, include = FALSE)
```

```{r}

library(extrafont)
fonts()

library(showtext)

font_add_google(name = "Rakkas",   # Name of the font on the Google Fonts site
                family = "rakkas") # Name you want to use to call the font


```


```{r}

library(tidyverse)

d <- read_csv("train.csv") %>% 
  mutate(across(
    where(is.character),
    as.factor
  ))

```

```{r}
library(skimr)

skim(d)

```

```{r}

glimpse(d)

```
```{r}

showtext_auto()

d %>% 
  ggplot(aes(customer_age, total_trans_amt, color = gender)) + 
  geom_jitter(alpha = 0.2) +
  scale_color_viridis_d() +
  theme_minimal() +
  theme(text = element_text(family = "rakkas")) +
  labs(x = "Credit Limit", y = "Total Transaction Amount", color = "Biological Sex",
       title = "Credit Limit Not That Related to Total Transaction Amount",
       subtitle = "At Least If We Look at a Linear Relationship") +
  geom_smooth(method = "lm", formula = "y ~ x")
  

```
```{r}

d %>% 
  ggplot(aes(customer_age, total_trans_amt, color = gender)) + 
  geom_jitter(alpha = 0.2) +
  scale_color_viridis_d() +
  theme_minimal() +
  labs(x = "Credit Limit", y = "Total Transaction Amount", color = "Biological Sex",
       title = "A Non-Linear Model Demands We Accept - Transcation Amounts",
       subtitle = "At Least It's Not a Map") +
  geom_smooth(method = "gam")

```
```{r}

library(ggridges)
library(wesanderson)

d %>% 
  mutate(gender = factor(case_when(
    
    gender == "F" ~ "Female",
    gender == "M" ~ "Male",
    TRUE ~ NA_character_
    
  ))) %>% 
  ggplot(aes(credit_limit, gender, fill = gender, color = gender)) +
  geom_density_ridges(alpha = 0.25, jittered_points = TRUE, position = "raincloud") +
  scale_fill_viridis_d(option = "turbo") +
  scale_color_viridis_d(option = "turbo") +
  theme(plot.title = element_text(family = "Bauhaus 93")) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(x = "Credit Limit", y = "Biological Sex",
       title = "Wow, Lots of Dudes Have 'Top Level' Credit Limits",
       subtitle = "I'm Sure That's Just a Coincidence...") +
  annotate("text", x = 20000, y = 2.5, label = "There are also fewer dudes at the low end of credit limit") +
  annotate("rect", xmin = 0, xmax = 7000, ymin = 1, ymax = 3, alpha = 0.2)

```
```{r, warning=FALSE}

library(ggalluvial)

glimpse(d)
# 
# d %>% 
#   count(income_category)

d %>% 
  group_by(income_category, education_level) %>% 
  summarise(freq = n()) %>% 
  mutate(
         education_level = fct_relevel(education_level, "Doctorate", "Post-Grad", "Graduate", "College",
                                       "High School","< High School", "Unknown"),
         income_category = fct_relevel(income_category, "$120K +", "$80K - $120K", "$60K - $80K",
                                       "$40K - $60K", "Less than $40K", "Unknown")) %>% 
  ggplot(aes(axis1 = education_level, axis2 = income_category, y = freq)) +
  geom_alluvium(aes(fill = education_level)) + 
  scale_x_discrete(limits = c("Education Level", "Income Bracket"), expand = c(.05, .05)) +
  geom_stratum(width = 1/8, fill = "black", color = "grey") +
  geom_label(stat = "stratum", aes(label = after_stat(stratum))) +
  labs(y = "Number of People", fill = "Education",
       title = "Some Variability in Folks' Income Bracket By Education") +
  scale_fill_viridis_d(option = "rocket")
  


```

```{r}

education_level = case_when(
    education_level == "Post-Graduate" ~ factor("Post-Grad"),
    education_level == "Uneducated" ~ factor("< High School"),
    TRUE ~ education_level
  ),

```

